{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Open Health Shield Data Model (OHSDM) v1.0",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0"
    },
    "resource_type": {
      "type": "string",
      "enum": [
        "SourceDoc",
        "Site",
        "Measurement",
        "GenomicObservation",
        "EpiEvent"
      ]
    },
    "id": {
      "oneOf": [
        {
          "type": "string",
          "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
        },
        {
          "type": "string",
          "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$"
        },
        {
          "type": "string",
          "minLength": 8
        }
      ]
    },
    "record_version": {
      "type": "integer",
      "minimum": 1
    },
    "ingested_at": {
      "type": "string",
      "format": "date-time",
      "pattern": "Z$"
    },
    "effective_at": {
      "type": "string",
      "format": "date-time",
      "pattern": "Z$"
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "pattern": "Z$"
    },
    "archived_at": {
      "type": "string",
      "format": "date-time",
      "pattern": "Z$"
    },
    "change_reason": {
      "type": "string",
      "maxLength": 2000
    },
    "audit_log": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "actor": {
            "type": "string"
          },
          "action": {
            "type": "string",
            "enum": [
              "created",
              "corrected",
              "superseded",
              "merged",
              "split",
              "redacted",
              "archived"
            ]
          },
          "at": {
            "type": "string",
            "format": "date-time",
            "pattern": "Z$"
          },
          "notes": {
            "type": "string"
          }
        },
        "required": [
          "actor",
          "action",
          "at"
        ]
      }
    },
    "provenance": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "sources": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "url",
                  "api",
                  "file",
                  "citation"
                ]
              },
              "href": {
                "type": "string"
              },
              "title": {
                "type": "string"
              },
              "sha256": {
                "type": "string",
                "minLength": 32
              }
            },
            "required": [
              "type"
            ]
          }
        },
        "license": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "id": {
              "type": "string"
            },
            "uri": {
              "type": "string"
            }
          },
          "required": [
            "id",
            "uri"
          ]
        },
        "quality_guideline_uri": {
          "type": "string"
        }
      },
      "required": [
        "sources",
        "license"
      ]
    },
    "security": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "classification": {
          "type": "string",
          "enum": [
            "public",
            "limited",
            "restricted",
            "confidential"
          ]
        },
        "pii_fields": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "privacy_impact": {
          "type": "string",
          "enum": [
            "low",
            "medium",
            "high"
          ]
        },
        "privacy_risk_score": {
          "type": "number",
          "minimum": 0
        },
        "consent_status": {
          "type": "string",
          "enum": [
            "not_applicable",
            "not_obtained",
            "obtained",
            "unknown"
          ]
        },
        "redactions": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "field": {
                "type": "string"
              },
              "method": {
                "type": "string",
                "enum": [
                  "mask",
                  "generalize",
                  "remove"
                ]
              },
              "note": {
                "type": "string"
              },
              "at": {
                "type": "string",
                "format": "date-time",
                "pattern": "Z$"
              }
            },
            "required": [
              "field",
              "method"
            ]
          }
        },
        "retention": {
          "type": "string"
        },
        "sharing_policy": {
          "type": "string",
          "enum": [
            "open",
            "shared",
            "no_external",
            "case_by_case"
          ]
        }
      },
      "required": [
        "classification"
      ]
    },
    "related_ids": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "resource_type": {
            "type": "string",
            "enum": [
              "SourceDoc",
              "Site",
              "Measurement",
              "GenomicObservation",
              "EpiEvent"
            ]
          },
          "id": {
            "type": "string"
          },
          "relation_type": {
            "type": "string",
            "enum": [
              "evidence_for",
              "member_of_cluster",
              "derived_from",
              "supports",
              "contradicts",
              "sample_for",
              "same_as"
            ]
          }
        },
        "required": [
          "resource_type",
          "id",
          "relation_type"
        ]
      }
    },
    "x_validation": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "period_order_ok": {
          "type": "boolean"
        },
        "h3_consistency_ok": {
          "type": "boolean"
        },
        "location_mode_ok": {
          "type": "boolean"
        },
        "refs_exist_ok": {
          "type": "boolean"
        }
      }
    },
    "body": {
      "type": "object",
      "additionalProperties": true
    }
  },
  "required": [
    "schema_version",
    "resource_type",
    "id",
    "record_version",
    "ingested_at",
    "provenance",
    "security",
    "body"
  ]
}